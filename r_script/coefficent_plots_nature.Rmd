---
title: "The Adoption of Climate-smart GroundnutVarieties Increases Agricultural Production and Smallholder Commercialization in West Africa"
subtitle: "Supplementary Material (Descriptive statistics)"
date: "Last updated: `r Sys.time()`"
output: 

 bookdown::pdf_document2:
    keep_tex: true
    template: HelperUtilities/my_templet.tex
 odt_document:
header-includes:
   - \usepackage[margin=2.8cm]{geometry}
   - \renewcommand{\contentsname}{Table of Contents}
   - \usepackage{enumitem}
   - \usepackage{pifont}
   - \renewcommand{\labelitemi}{$\rightarrow$}
   - \usepackage{tocloft}
   - \renewcommand\cftsecleader{\cftdotfill{\cftdotsep}}
   - \usepackage{hyperref}
   - \hypersetup{linkcolor = blue}
   - \usepackage{hanging}
   - \usepackage[T1]{fontenc}
   - \usepackage{graphicx}
   - \usepackage{booktabs,threeparttablex}
   - \usepackage{pdflscape}
   - \usepackage{fvextra}
   - \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
   - \usepackage{lmodern}
   - \usepackage{nimbusmono}
   - \renewcommand{\thetable}{SM\arabic{table}}
   - \setlength{\cfttabnumwidth}{1cm}

toc: false
toccolor: 'blue'
mainfont: 'lm'
toc-title: "-"
---
\newpage
\listoftables
\newpage


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  echo = FALSE,
  warning = FALSE,
  tidy = TRUE,
  tidy.opts = list(width.cutoff = 10),
  # if knitting to html disable the following line
  dev = "cairo_pdf",
  out.width = "100%"
)

options(width = 100)
# load the required libraries
extrafont::loadfonts()

# load the required libraries
pacman::p_load(
  jsonlite,
  sjlabelled,
  labelled,
  dataMaid,
  plotly,
  wesanderson,
  ggthemes,
  hrbrthemes,
  sjmisc,
  expss,
  haven,
  ggstream,
  ggthemr,
  ggstatsplot,
  highcharter,
  gtsummary,
  tidyverse
)

ggthemr(palette = 'light')
#my_font <- font_an
```


```{r}

source("HelperUtilities/Utils.R", local = knitr::knit_global())
my_font <- "Frutiger"
```

```{r}
data_for_plotting_ori <- read_csv("data/for_latex/forplot/data_for_plotting.csv")%>%
  janitor::clean_names()

Groundnut_new <- read_dta("data/for_plot/data_for_descriptive.dta")
```

```{r}
df_plot <- data_for_plotting_ori%>%
  mutate(p.label = case_when(
    !is.na(aster) ~paste0(coef, aster) ,
    TRUE ~ paste0(coef, "")
  ) )
```

# Write a generic function

```{r}
plot_coefficents <- function(tbl_Num=2, X="inters_var"){
  
  df_tbl_1 <- df_plot%>%
  filter(tbl_no==tbl_Num)

  plt_tbl_1 <- 
    ggplot(df_tbl_1, aes_string(x = X, y = "coef", colour = "inters_var")) +
    geom_hline(
      yintercept = 0,
      size = 0.3,
      color = "grey"
    ) +
    geom_point(position = position_dodge(0.3), size = 3) +
    geom_errorbar(
      aes_string(ymin = "ci_low", ymax = "ci_high"), 
      position = position_dodge(0.4),
      width = 0.1
    ) +
    geom_text(
      aes_string(label = "p.label"),
      position = position_dodge(0.6),
      #vjust = 0.5 * -1.5,
      hjust = -0.2,
      show.legend = FALSE,
      size = 4,
      family = my_font
    ) +
  scale_x_discrete(labels=c("Adoption", "Area under\nadoption (ha)")) +
    facet_wrap(~dep_var, scales = "free_y") +
    labs(
      y = "Estimates(95% Robust CI)",
      title = "",
      subtitle = "",
      x = ""
    ) +
    ggthemes::theme_base() +
    theme(
      legend.position = "none",
      text = element_text(family = my_font, size = 14),
      axis.text = element_text(family = my_font, size = 14),
      strip.background = element_rect(fill = adjustcolor("#95BAFF", alpha.f = 0.6)),
      panel.border = element_rect(size = 0, fill = NA),
      strip.text = element_text(
        family = my_font,
        size = 14, color = "black" ))
  
  return(plt_tbl_1)
  
}
```


# Figure 2. Adoption rate over time

```{r}
adoption_data <- Groundnut_new%>%
  select(year, country, adopt)

df <- adoption_data%>%
  group_by(year, country, adopt)%>%
  summarise(count = n()) %>%
   mutate(ptg = round(prop.table(count) *
        100, 1))%>%
  filter(adopt==1)%>%
  mutate(year= factor(year))

ss <- ggplot(df, aes(x = country,
    y = ptg)) + geom_bar(aes(fill = year),
    stat = "identity",
    color = "white",
    position = position_dodge(0.8),
    size = 0.3, alpha = 0.9,
    width = 0.7) + 
  geom_text(aes(
    label = paste0(ptg, "%"),group=year), color = "black",  vjust=-0.3, family=my_font,size=5,
    position = position_dodge(.8)) +
    theme_bw(base_family = my_font,
    base_size = 16) +
  labs(y="Percent of Adopters", x=NULL)+
    scale_y_continuous(labels = scales::label_percent(scale = 1)) +
    #scale_fill_manual(values = c("#30469c","#8c0049", "#EEAB73")) +
  scale_fill_manual(values = c("#B8D1FF", "#95BAFF", "#305596"))+
    theme(panel.grid.major.y = element_blank(),
          legend.position = "bottom",
          legend.title = element_blank(),
          axis.title = element_text(color = "#51585F"),
        panel.grid.major.x = element_line(size = 0.3),
        panel.grid.minor.y = element_line(size = 0.3), panel.border = element_rect(colour = "grey60"))

ss

ggsave("figures/fig_2.png", plot = ss, width = 20, height = 15, units = "cm")
```
# Figure 3. 2SLS estimates of the relationship between adoption, production, and yields

```{r}
 df_tbl_3 <- df_plot%>%
  filter(tbl_no==3)%>%
  mutate(dep_var=factor(dep_var, levels = c("Yield","Production", "Production value"),labels  = c("Yield","Production", "Production value")))

  plt_tbl_3 <- 
    ggplot(df_tbl_3, aes_string(x = "inters_var", y = "coef", colour = "inters_var")) +
    geom_hline(
      yintercept = 0,
      size = 0.3,
      color = "grey"
    ) +
    geom_point(position = position_dodge(0.3), size = 3) +
    geom_errorbar(
      aes_string(ymin = "ci_low", ymax = "ci_high"), 
      position = position_dodge(0.4),
      width = 0.1
    ) +
    geom_text(
      aes_string(label = "p.label"),
      position = position_dodge(0.6),
      #vjust = 0.5 * -1.5,
      hjust = -0.2,
      show.legend = FALSE,
      size = 4,
      family = my_font
    ) +
  scale_x_discrete(labels=c("Adoption", "Area under\nadoption (ha)")) +
    facet_wrap(~dep_var, scales = "free_y") +
    labs(
      y = "Estimates(95% Robust CI)",
      title = "",
      subtitle = "",
      x = ""
    ) +
    ggthemes::theme_base() +
    theme(
      legend.position = "none",
      text = element_text(family = my_font, size = 14),
      axis.text = element_text(family = my_font, size = 14),
      strip.background = element_rect(fill = adjustcolor("#95BAFF", alpha.f = 0.6)),
      panel.border = element_rect(size = 0, fill = NA),
      strip.text = element_text(
        family = my_font,
        size = 14, color = "black" ))
  plt_tbl_3
  
  ggsave("figures/fig_3.png", plt_tbl_3, width = 30, height = 18, units = "cm")
```

# Figure 4. 2SLS estimates of the relationship between adoption and commercialization.

```{r}
df_tbl_4 <- df_plot%>%
  filter(tbl_no==4)%>%
  mutate(inters_var = factor(inters_var, labels = c(`Adoption dummy` = "Adoption\ndummy" , 
        `Area under adoption (ha)`="Area under\n adoption (ha)")))
plt_tbl_4 <- 
    ggplot(df_tbl_4, aes_string(x = "model_type", y = "coef", colour = "model_type")) +
    geom_hline(
      yintercept = 0,
      size = 0.3,
      color = "grey"
    ) +
    geom_point(position = position_dodge(0.3), size = 3) +
    geom_errorbar(
      aes_string(ymin = "ci_low", ymax = "ci_high"), 
      position = position_dodge(0.4),
      width = 0.1
    ) +
    geom_text(
      aes_string(label = "p.label"),
      position = position_dodge(0.6),
      #vjust = 0.5 * -1.5,
      hjust = -0.2,
      show.legend = FALSE,
      size = 3.5,
      family = my_font
    ) +
    scale_x_discrete(labels=c("Correlated\nrandom effects ", "Fixed\nEffects")) +
    facet_grid(inters_var~dep_var, scales = "free") +
    labs(
      y = "Estimates(95% Robust CI)",
      title = "",
      subtitle = "",
      x = ""
    ) +
    ggthemes::theme_base() +
    theme(
      legend.position = "none",
      text = element_text(family = my_font, size = 14),
      axis.text = element_text(family = my_font, size = 14),
      strip.background = element_rect(fill = adjustcolor("#95BAFF", alpha.f = 0.6)),
      panel.border = element_rect(size = 0, fill = NA),
      strip.text = element_text(
        family = my_font,
        size = 14, color = "black"
      ),strip.text.y = element_text(family = my_font, size = 12))

plt_tbl_4

ggsave("figures/fig_4.png", plt_tbl_4, width = 24, height = 16, units = "cm")

```
# Figure 5. 2SLS estimates of the relationship between continuous adoption and commercialization.

```{r}
df_tbl_5 <- df_plot%>%
  filter(tbl_no==5)

plt_tbl_5 <- 
    ggplot(df_tbl_5, aes_string(x = "inters_var", y = "coef", colour = "inters_var")) +
    geom_hline(
      yintercept = 0,
      size = 0.3,
      color = "grey"
    ) +
    geom_point(position = position_dodge(0.3), size = 3) +
    geom_errorbar(
      aes_string(ymin = "ci_low", ymax = "ci_high"), 
      position = position_dodge(0.4),
      width = 0.1
    ) +
    geom_text(
      aes_string(label = "p.label"),
      position = position_dodge(0.6),
      #vjust = 0.5 * -1.5,
      hjust = -0.2,
      show.legend = FALSE,
      size = 4,
      family = my_font
    ) +
    scale_x_discrete(labels=c("Sustained adoption\n(3 years)")) +
    facet_wrap(~dep_var, scales = "free_y") +
    labs(
      y = "Estimates(95% Robust CI)",
      title = "",
      subtitle = "",
      x = ""
    ) +
    ggthemes::theme_base() +
    theme(
     legend.position = "none",
      text = element_text(family = my_font, size = 14),
      axis.text = element_text(family = my_font, size = 14),
      strip.background = element_rect(fill = adjustcolor("#95BAFF", alpha.f = 0.6)),
      panel.border = element_rect(size = 0, fill = NA),
      strip.text = element_text(
        family = my_font,
        size = 14, color = "black"
      ))

plt_tbl_5
ggsave("figures/fig_5.png", plt_tbl_5, width = 26, height = 12, units = "cm")

```
# Figure 6. Cross-country analysis of adoption and commercialization

```{r}


df_tbl_6 <- df_plot%>%
  filter(tbl_no==6)%>%
  mutate(dep_var=factor(dep_var, levels = c("Yield", "Market participation")))

  plt_tbl_6 <- 
    ggplot(df_tbl_6, aes_string(x = "country", y = "coef", colour = "country")) +
    geom_hline(
      yintercept = 0,
      size = 0.3,
      color = "grey"
    ) +
    geom_point(position = position_dodge(0.3), size = 3) +
    geom_errorbar(
      aes_string(ymin = "ci_low", ymax = "ci_high"), 
      position = position_dodge(0.4),
      width = 0.1
    ) +
    geom_text(
      aes_string(label = "p.label"),
      position = position_dodge(0.55),
      #vjust = 0.5 * -1.5,
      hjust = -0.18,
      show.legend = FALSE,
      size = 4,
      family = my_font
    ) +
    #scale_x_discrete(labels=c("Commercialization", "Yield")) +
    facet_wrap(~dep_var, scales = "free_y") +
    labs(
      y = "Estimates(95% Robust CI)",
      title = "",
      subtitle = "",
      x = ""
    ) +
    ggthemes::theme_base() +
    theme(
      legend.position = "none",
      text = element_text(family = my_font, size = 14),
      axis.text = element_text(family = my_font, size = 14),
      strip.background = element_rect(fill = adjustcolor("#95BAFF", alpha.f = 0.6)),
      panel.border = element_rect(size = 0, fill = NA),
      strip.text = element_text(
        family = my_font,
        size = 14, color = "black" ))
  
  plt_tbl_6
   ggsave("figures/fig_6.png", plt_tbl_6, width = 30, height = 13, units = "cm", dpi = 300)
```
# Figure 8. Linear IV mediation analysis of adoption and commercialization 

```{r}


df_tbl_8 <- df_plot%>%
  filter(tbl_no==8)

  plt_tbl_8 <- 
    ggplot(df_tbl_8, aes_string(x = "inters_var", y = "coef", colour = "inters_var")) +
    geom_hline(
      yintercept = 0,
      size = 0.3,
      color = "grey"
    ) +
    geom_point(position = position_dodge(0.3), size = 3) +
    geom_errorbar(
      aes_string(ymin = "ci_low", ymax = "ci_high"), 
      position = position_dodge(0.4),
      width = 0.1
    ) +
    geom_text(
      aes_string(label = "p.label"),
      position = position_dodge(0.55),
      #vjust = 0.5 * -1.5,
      hjust = -0.18,
      show.legend = FALSE,
      size = 6,
      family = my_font
    ) +
    scale_x_discrete(labels=c("Direct\nEffect", "Indirect\nEffect", "Total\nEffect")) +
    facet_wrap(~dep_var, scales = "free_y") +
    labs(
      y = "Estimates(95% Robust CI)",
      title = "",
      subtitle = "",
      x = ""
    ) +
    ggthemes::theme_base() +
    theme(
      legend.position = "none",
      text = element_text(family = my_font, size = 14),
      axis.text = element_text(family = my_font, size = 14),
      strip.background = element_rect(fill = adjustcolor("#95BAFF", alpha.f = 0.6)),
      panel.border = element_rect(size = 0, fill = NA),
      strip.text = element_text(
        family = my_font,
        size = 14, color = "black" ))
  
  plt_tbl_8
   ggsave("figures/fig_8.svg", plt_tbl_8, width = 30, height = 15, units = "cm", dpi = 400)
```
# Figure SM1. OLS estimates of the relationship between adoption and commercialization

```{r}
 df_tbl_sm1 <- df_plot%>%
  filter(tbl_no==1)

  plt_tbl_sm1 <- 
    ggplot(df_tbl_sm1, aes_string(x = "inters_var", y = "coef", colour = "inters_var")) +
    geom_hline(
      yintercept = 0,
      size = 0.3,
      color = "grey"
    ) +
    geom_point(position = position_dodge(0.3), size = 3) +
    geom_errorbar(
      aes_string(ymin = "ci_low", ymax = "ci_high"), 
      position = position_dodge(0.4),
      width = 0.1
    ) +
    geom_text(
      aes_string(label = "p.label"),
      position = position_dodge(0.6),
      #vjust = 0.5 * -1.5,
      hjust = -0.2,
      show.legend = FALSE,
      size = 4,
      family = my_font
    ) +
  scale_x_discrete(labels=c("Adoption", "Area under\nadoption (ha)")) +
    facet_wrap(~dep_var, scales = "free_y") +
    labs(
      y = "Estimates(95% Robust CI)",
      title = "",
      subtitle = "",
      x = ""
    ) +
    ggthemes::theme_base() +
    theme(
      legend.position = "none",
      text = element_text(family = my_font, size = 14),
      axis.text = element_text(family = my_font, size = 14),
      strip.background = element_rect(fill = adjustcolor("#95BAFF", alpha.f = 0.6)),
      panel.border = element_rect(size = 0, fill = NA),
      strip.text = element_text(
        family = my_font,
        size = 14, color = "black" ))
  plt_tbl_sm1
  
  ggsave("figures/fig_SM1.png", plt_tbl_sm1, width = 30, height = 15, units = "cm")
```

# Figure SM2. OLS estimates of the relationship between adoption, production, and yields

```{r}
 df_tbl_sm2 <- df_plot%>%
  filter(tbl_no==2)%>%
  mutate(dep_var=factor(dep_var, levels = c("Yield","Production", "Production value"),labels  = c("Yield","Production", "Production value")))

  plt_tbl_sm2 <- 
    ggplot(df_tbl_sm2, aes_string(x = "inters_var", y = "coef", colour = "inters_var")) +
    geom_hline(
      yintercept = 0,
      size = 0.3,
      color = "grey"
    ) +
    geom_point(position = position_dodge(0.3), size = 3) +
    geom_errorbar(
      aes_string(ymin = "ci_low", ymax = "ci_high"), 
      position = position_dodge(0.4),
      width = 0.1
    ) +
    geom_text(
      aes_string(label = "p.label"),
      position = position_dodge(0.6),
      #vjust = 0.5 * -1.5,
      hjust = -0.15,
      show.legend = FALSE,
      size = 4.5,
      family = my_font
    ) +
  scale_x_discrete(labels=c("Adoption", "Area under\nadoption (ha)")) +
    facet_wrap(~dep_var, scales = "free_y") +
    labs(
      y = "Estimates(95% Robust CI)",
      title = "",
      subtitle = "",
      x = ""
    ) +
    ggthemes::theme_base() +
    theme(
      legend.position = "none",
      text = element_text(family = my_font, size = 14),
      axis.text = element_text(family = my_font, size = 14),
      strip.background = element_rect(fill = adjustcolor("#95BAFF", alpha.f = 0.6)),
      panel.border = element_rect(size = 0, fill = NA),
      strip.text = element_text(
        family = my_font,
        size = 14, color = "black" ))
  plt_tbl_sm2
  
  ggsave("figures/fig_SM2.png", plt_tbl_sm2, width = 35, height = 15, units = "cm")
```